<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEBUG - Ivory Papers Viewer</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
            line-height: 1.6;
        }
        .step { margin: 10px 0; padding: 10px; background: #111; border-left: 3px solid #0f0; }
        .error { border-left-color: #f00; color: #f00; }
        .success { border-left-color: #0f0; color: #0f0; }
        .warning { border-left-color: #ff0; color: #ff0; }
        pre { background: #222; padding: 10px; overflow-x: auto; }
        #content { margin-top: 20px; padding: 20px; background: #1a1a1a; border: 2px solid #0f0; }
    </style>
</head>
<body>
    <h1>üîç IVORY PAPERS VIEWER - DEBUG MODE</h1>
    <div id="debug-log"></div>
    <hr>
    <div id="content">Loading content...</div>

    <script>
        // Debug logger
        const debugLog = [];
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.push({timestamp, message, type});
            console.log(`[${timestamp}] ${message}`);
            updateDebugDisplay();
        }

        function updateDebugDisplay() {
            const logDiv = document.getElementById('debug-log');
            logDiv.innerHTML = debugLog.map(entry => {
                const className = entry.type === 'error' ? 'error' :
                                 entry.type === 'success' ? 'success' :
                                 entry.type === 'warning' ? 'warning' : '';
                return `<div class="step ${className}">[${entry.timestamp}] ${entry.message}</div>`;
            }).join('');
        }

        // Step 1: Script is running
        log('‚úì JavaScript is executing', 'success');

        // Step 2: Check if we're in a browser
        log(`‚úì Environment: ${typeof window !== 'undefined' ? 'Browser' : 'Other'}`, 'success');
        log(`‚úì Document ready state: ${document.readyState}`, 'success');

        // Step 3: Check if marked library exists (inline check)
        log(`Checking for marked library...`, 'info');
        if (typeof marked === 'undefined') {
            log('‚úó marked library NOT FOUND - This is the problem!', 'error');
            log('The embedded marked.js did not load properly', 'error');
        } else {
            log('‚úì marked library is available', 'success');
            log(`‚úì marked version: ${marked.version || 'unknown'}`, 'success');
        }

        // Step 4: Check DOM elements
        log('Checking DOM elements...', 'info');
        const contentDiv = document.getElementById('content');
        if (contentDiv) {
            log('‚úì Content div found', 'success');
        } else {
            log('‚úó Content div NOT found', 'error');
        }

        // Step 5: DOMContentLoaded event
        log('Setting up DOMContentLoaded listener...', 'info');

        document.addEventListener('DOMContentLoaded', () => {
            log('‚úì DOMContentLoaded event fired', 'success');

            // Try to render simple markdown
            const testMarkdown = '# Test Header\n\nThis is a **test** of the markdown parser.';

            if (typeof marked !== 'undefined') {
                try {
                    const html = marked(testMarkdown);
                    log('‚úì marked.parse() worked successfully', 'success');
                    document.getElementById('content').innerHTML = `
                        <h2 style="color: #0f0;">‚úì SUCCESS - Markdown Parser is Working!</h2>
                        <p>The viewer should be working. Here's a test:</p>
                        ${html}
                        <hr>
                        <p><strong>What this means:</strong></p>
                        <ul>
                            <li>JavaScript is executing ‚úì</li>
                            <li>marked.js library is loaded ‚úì</li>
                            <li>Markdown parsing works ‚úì</li>
                        </ul>
                        <p style="color: #ff0;"><strong>BUT you're seeing "Loading content..." on the real viewer?</strong></p>
                        <p>This means the real viewer-standalone.html file on your server is DIFFERENT from the one on your computer.</p>
                        <p><strong>Solution:</strong></p>
                        <ol>
                            <li>Delete the old viewer-standalone.html from your server</li>
                            <li>Re-upload the 219 KB version</li>
                            <li>Check file size after upload (should be exactly 219 KB)</li>
                            <li>Clear browser cache and try again</li>
                        </ol>
                    `;
                    log('‚úì Content div updated with test content', 'success');
                } catch (error) {
                    log(`‚úó Error parsing markdown: ${error.message}`, 'error');
                    document.getElementById('content').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                }
            } else {
                log('‚úó marked is still undefined in DOMContentLoaded', 'error');
                document.getElementById('content').innerHTML = '<p style="color: red;">ERROR: Markdown parser (marked.js) failed to load.</p><p>The embedded library might be corrupted or not included in the file.</p>';
            }
        });

        // Immediate check (before DOMContentLoaded)
        log(`Current URL: ${window.location.href}`, 'info');
        log(`User Agent: ${navigator.userAgent}`, 'info');

        // Log completion
        log('Debug script setup complete. Waiting for DOMContentLoaded...', 'info');
    </script>
</body>
</html>
